<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Cam Recorder</title>

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container w-100  bg-black">
        <video id="screen" width="100%" height="650px" autoplay></video>
    </div>
    <div class="container text-center text-white z-1 bg-black">
        <button id="rcdStart" class="btn btn-danger">Record</button>
        <button id="rcdStop" class="btn btn-danger">Stop</button>
    </div>

    <script>
        var Vdo_screen = document.getElementById("screen");
        var Rcd_start = document.getElementById("rcdStart");
        var Rcd_stop = document.getElementById("rcdStop");

        var mediarecorder;
        var options = { mimeType: "video/webm;codecs=vp9" };
        var recordedChunks = [];

        if (Vdo_screen) {  // if video screen is opened
            console.log("we have the video");
            navigator.mediaDevices.getUserMedia({ video: true, audio: true }) //setting video &audio true
                .then(gotStream)
                .catch(function (e) {  // error while opening the video screen
                    if (confirm("An error with camera occured:(" + e.name + ")Do you want to reload?")) {
                        location.reload();  //reload the page
                    }
                });
        }

        // if stream found
        function gotStream(stream) {
            console.log("Adding local stream");
            Vdo_screen.srcObject = stream;
            mediarecorder = new MediaRecorder(stream, options);
            mediarecorder.ondataavailable = handleDataAvailable;
            mediarecorder.onstop = download;
        }

        //Start recording
        if (Rcd_start) {
            Rcd_start.addEventListener('click', () => {
                mediarecorder.start();
            });
        }

        // Stop recording
        if (Rcd_stop) {
            Rcd_stop.addEventListener("click", () => {
                mediarecorder.stop();
            });
        }

        //store recording 
        function handleDataAvailable(event) {
            if (event.data.size > 0) {
                recordedChunks.push(event.data);  //media is stored as chunks
                console.log(event.data);
            }
        }

        //download the recorded video
        function download() {
            var blob = new Blob(recordedChunks, { type: 'video/webm' });  //blob is media storing type
            var url = URL.createObjectURL(blob);  //generate url for blob
            var a = document.createElement('a');  // creating link
            document.body.appendChild(a);   //including the link in document
            a.style = 'display:none';   //hiding the link
            a.href = url; //assign url to the created link
            a.download = 'test.webm';  //download tthe recording
            a.click();  //click event on the link
            window.URL.revokeObjectURL(url);  //opening the link
        }


    </script>
</body>

</html>